{% extends "layout.html" %} {% block content %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand font-weight-bold" href="#">Woocom Orders</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="{{url_for('webhooks')}}">Orders</a>
          </li>
        </ul>
    </div>
</div>
</nav>
<div  class="mt-3 ml-3 d-flex mr-3">
<div class="ml-auto">
  <form autocomplete="off" class = "form-inline" role = "form">
    <select multiple title="Order ID" name="order_id" class="selectpicker mr-2">
      {% for o in orders %}
      <option {% if "order_id" in query %} {% if o.id in query["order_id"] %} selected {% endif %} {% endif %}>{{o.id}}</option>
      {% endfor%}
    </select>
    <select title="Status" name="status" class="selectpicker mr-2">
      <option value="">Status</option>
      <option {% if "status" in query %} {% if query.status[0] == "on-hold" %} selected {% endif %} {% endif %} value="on-hold">On Hold</option>
      <option {% if "status" in query %} {% if query.status[0] == "processing" %} selected {% endif %} {% endif %} value="processing">Processing</option>
      <option {% if "status" in query %} {% if query.status[0] == "failed" %} selected {% endif %} {% endif %} value="failed">Failed</option>
    </select>
    <select title="Payment Status" name="payment_status" class="selectpicker mr-2">
      <option value="">Payment Status</option>
      <option {% if "payment_status" in query %} {% if query.payment_status[0] == "paid" %} selected {% endif %} {% endif %} value="paid">Paid</option>
      <option {% if "payment_status" in query %} {% if query.payment_status[0] == "unpaid" %} selected {% endif %} {% endif %} value="unpaid">Unpaid</option>
    </select>
    <script>
      $( function() {
        $( "#datepicker" ).datepicker();
      } );
      </script>
    <input class="form-control mr-2" type="text" placeholder="Payment Date" {% if "payment_date" in query %} {% if query["payment_date"][0] != "" %} value="{{query["payment_date"][0]}}" {% endif %} {% endif %} name="payment_date" id="datepicker">
    <input class="form-control mr-2" type="phone" placeholder="Phone Number" {% if "phone_number" in query %} {% if query["phone_number"][0] != "" %} value="{{query["phone_number"][0]}}" {% endif %} {% endif %} name="phone_number">
    <input class="form-control mr-2" type="name" placeholder="Name" {% if "name" in query %} {% if query["name"][0] != "" %} value="{{query["name"][0]}}" {% endif %} {% endif %} name="name">
    <button class="btn btn-info"><i class="fa fa-filter" aria-hidden="true"></i>
    </button>
  </form>
</div>
</div>
<div class="ml-3 mr-3 pt-3">
  <table class="table">
    <thead>
      <tr class="bg-info text-white">
        <th scope="col"></th>
        <th scope="col">Order ID</th>
        <th scope="col">Customer Name</th>
        <th scope="col">Phone Number</th>
        <th scope="col">City</th>
        <th scope="col">Status</th>
        <th scope="col">Payment Status</th>
        <th scope="col">Payment Type</th>
        <th scope="col">Order Date</th>
        <th scope="col">Amount</th>
        <th scope="col">Refund</th>
        <th scope="col">Amount Payble</th>
      </tr>
    </thead>
    <tbody>
      {% for o in orders %}
      <tr>
        <td scope="row">
          <i title="Order Detail Message" onclick="copyToClipboard('s_msg_{{o.id}}')" class="fa fa-clipboard btn btn-warning"style="cursor: pointer;" aria-hidden="true"></i>
          <i title="Supplier Message" onclick="copyToClipboard('c_msg_{{o.id}}')" class="fa fa-clipboard btn btn-warning ml-2"style="cursor: pointer;" aria-hidden="true"></i>
          <p style="display: none;" id="c_msg_{{o.id}}">
            {{o.c_msg}}
          </p>
          <p style="display: none;" id="s_msg_{{o.id}}">
            {{o.s_msg}}
          </p>
        </td>
        <td scope="row">{{ o.id}}</td>
        <td scope="row">{{ o.billing.first_name}} {{ o.billing.last_name}}</td>
        <td scope="row">{{ o.billing.phone}}</td>
        <td scope="row">{{ o.billing.city}}</td>
        <td scope="row">{{ o.status}}</td>
        {% if o.date_paid == None %}
            <td scope="row">Unpaid</td>
            {% else %}
            <td scope="row">Paid</td>
        {% endif %}
        <td scope="row">{{ o.payment_method}}</td>
        <td scope="row">{{ o.date_created}}</td>
        <td scope="row">{{ o.total}}</td>
        <td scope="row">{{ o.total_refunds}}</td>
        <td scope="row">{{ o.total-o.total_refunds}}</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<script>
  function copyToClipboard(id) {
   console.log(id);
   var tag = document.getElementById(""+id+"")
   var text = tag.innerHTML.trim()
   var input = document.body.appendChild(document.createElement("textarea"));
   input.value = text;
   input.select();
   var status = document.execCommand("copy");
   input.parentNode.removeChild(input);
 }
 </script>
 
{% endblock %}
