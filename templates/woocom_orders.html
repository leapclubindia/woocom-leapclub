{% extends "layout.html" %} {% block content %}
<nav class="navbar navbar-expand-lg navbar-dark bg-dark">
  <div class="container">
    <a class="navbar-brand font-weight-bold" href="#">Orders</a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
        <ul class="navbar-nav ml-auto">
          <li class="nav-item">
            <a class="nav-link" href="{{url_for('logout')}}">
              <i class="fa fa-sign-out" aria-hidden="true"></i>
              Logout</a>
          </li>
        </ul>
    </div>
</div>
</nav>
<ul class="nav nav-tabs mt-2 ml-1">
  <li class="nav-item">
    <a class="nav-link {% if nav_active == 'pending' %} active {%endif%}" href="{{url_for('woocom_orders', status='pending')}}">Pending</a>
  </li>
  <li class="nav-item">
    <a class="nav-link {% if nav_active == 'processing' %} active {%endif%}" href="{{url_for('woocom_orders', status='processing')}}">Processing</a>
  </li>
  <li class="nav-item">
    <a class="nav-link {% if nav_active == 'on-hold' %} active {%endif%}" href="{{url_for('woocom_orders', status='on-hold')}}">On-hold</a>
  </li>
  <li class="nav-item">
    <a class="nav-link {% if nav_active == 'completed' %} active {%endif%}" href="{{url_for('woocom_orders', status='completed')}}">Completed</a>
  </li>
  <li class="nav-item">
    <a class="nav-link {% if nav_active == 'cancelled' %} active {%endif%}" href="{{url_for('woocom_orders', status='cancelled')}}">Cancelled</a>
  </li>
  <li class="nav-item">
    <a class="nav-link {% if nav_active == 'refunded' %} active {%endif%}" href="{{url_for('woocom_orders', status='refunded')}}">Refunded</a>
  </li>
  <li class="nav-item">
    <a class="nav-link {% if nav_active == 'failed' %} active {%endif%}" href="{{url_for('woocom_orders', status='failed')}}">Failed</a>
  </li>
  <li class="nav-item">
    <a class="nav-link {% if nav_active == 'trash' %} active {%endif%}" href="{{url_for('woocom_orders', status='trash')}}">Trash</a>
  </li>
  <li class="nav-item">
    <a class="nav-link {% if nav_active == 'any' %} active {%endif%}" href="{{url_for('woocom_orders')}}">All</a>
  </li>
</ul>
<div  class="mt-3 ml-3 mr-3">
    <form autocomplete="off" class = "form-inline" role = "form">
      {% if nav_active != '' %}
        <input style="display: none;" name="status" value="{{nav_active}}">
      {% endif %}
      {% if page != 1 %}
      <input style="display: none;" name="page" value="{{page}}">
    {% endif %}
      <select multiple title="Order ID" name="order_ids" class="selectpicker mr-2">
        {% for o in orders %}
        <option {% if "order_ids" in query %} {% if o.id in query["order_ids"] %} selected {% endif %} {% endif %}>{{o.id}}</option>
        {% endfor%}
      </select>
      <select title="Payment Status" name="payment_status" class="selectpicker mr-2">
        <option value="">Payment Status</option>
        <option {% if "payment_status" in query %} {% if query.payment_status[0] == "paid" %} selected {% endif %} {% endif %} value="paid">Paid</option>
        <option {% if "payment_status" in query %} {% if query.payment_status[0] == "unpaid" %} selected {% endif %} {% endif %} value="unpaid">Unpaid</option>
      </select>
      <script>
        $( function() {
          $( "#datepicker" ).datepicker();
        } );
        </script>
      <input class="form-control mr-2" type="text" placeholder="Payment Date" {% if "payment_date" in query %} {% if query["payment_date"][0] != "" %} value="{{query["payment_date"][0]}}" {% endif %} {% endif %} name="payment_date" id="datepicker">
      <input class="form-control mr-2" type="phone" placeholder="Phone Number" {% if "phone_number" in query %} {% if query["phone_number"][0] != "" %} value="{{query["phone_number"][0]}}" {% endif %} {% endif %} name="phone_number">
      <input class="form-control mr-2" type="name" placeholder="Name" {% if "name" in query %} {% if query["name"][0] != "" %} value="{{query["name"][0]}}" {% endif %} {% endif %} name="name">
      <button class="btn btn-info"><i class="fa fa-filter" aria-hidden="true"></i>
      </button>
    </form>
    <form autocomplete="off" action="{{url_for('download_csv')}}", method="POST" class = "form-inline mt-2" role = "form">
      {% if nav_active != '' %}
        <input style="display: none;" name="status" value="{{nav_active}}">
      {% endif %}
      <select multiple required title="Order ID" name="order_ids" class="selectpicker mr-2">
        {% for o in orders %}
        <option>{{o.id}}</option>
        {% endfor%}
      </select>
      <button class="btn btn-info"><i class="fa fa-download" aria-hidden="true"></i>
      </form>
</div>
<div class="ml-1 mr-1 pt-3">
  <table class="table">
    <thead>
      <tr class="bg-info text-white">
        <th scope="col"></th>
        <th scope="col">Order ID</th>
        <th scope="col">Customer Name</th>
        <th scope="col">Phone Number</th>
        <th scope="col">City</th>
        <th scope="col">Status</th>
        <th scope="col">Payment Status</th>
        <th scope="col">Payment Type</th>
        <th scope="col">Order Date</th>
        <th scope="col">Amount</th>
        <th scope="col">Refund</th>
        <th scope="col">Amount Payble</th>
        <th scope="col">Whatsapp Messages</th>
      </tr>
    </thead>
    <tbody>
      {% for o in orders %}
      <tr>
        <td scope="row">
          <div style="min-width: 160px;">
          <i title="Order Detail Message" onclick="copyToClipboard('s_msg_{{o.id}}')" class="fa fa-clipboard btn-sm btn btn-warning"style="cursor: pointer;" aria-hidden="true"></i>
          <i title="Supplier Message" onclick="copyToClipboard('c_msg_{{o.id}}')" class="fa fa-clipboard btn-sm btn btn-warning ml-1"style="cursor: pointer;" aria-hidden="true"></i>
          {% if nav_active == "completed"%}
              <a href="{{url_for('send_whatsapp', mobile_number=o.billing.phone, name=o.billing.first_name+' '+o.billing.last_name, status=nav_active, page = page, order_ids=query['order_ids'],order_id=o.id, noti='payment_remainder_msg')}}">
                <i title="Payment Remainder" class="fa fa-whatsapp btn btn-success btn-sm ml-1" aria-hidden="true"></i>
              </a>
              <a href="{{url_for('send_whatsapp', mobile_number=o.billing.phone, name=o.billing.first_name+' '+o.billing.last_name, status=nav_active, page = page, order_ids=query['order_ids'],order_id=o.id, noti='feedback_msg')}}">
                <i title="Feedback" class="fa fa-whatsapp btn btn-success btn-sm ml-1" aria-hidden="true"></i>
              </a>
          {% endif %}
          {% if nav_active == "processing"%}
              <a href="{{url_for('send_whatsapp', mobile_number=o.billing.phone, name=o.billing.first_name+' '+o.billing.last_name, status=nav_active, page = page, order_ids=query['order_ids'],order_id=o.id, noti='hello_msg')}}">
                <i title="Hello Message" class="fa fa-whatsapp btn btn-success btn-sm ml-1" aria-hidden="true"></i>
              </a>
              <a href="{{url_for('send_whatsapp', mobile_number=o.billing.phone, name=o.billing.first_name+' '+o.billing.last_name, status=nav_active, page = page, order_ids=query['order_ids'],order_id=o.id, noti='delivery_notification_msg')}}">
                <i title="Delivery Notification" class="fa fa-whatsapp btn btn-success btn-sm ml-1" aria-hidden="true"></i>
              </a>
          {% endif %}
          <p style="display: none;" id="c_msg_{{o.id}}">
            {{o.c_msg}}
          </p>
          <p style="display: none;" id="s_msg_{{o.id}}">
            {{o.s_msg}}
          </p>
          </div>
        </td>
        <td scope="row">{{ o.id}}</td>
        <td scope="row">{{ o.billing.first_name}} {{ o.billing.last_name}}</td>
        <td scope="row">{{ o.billing.phone}}</td>
        <td scope="row">{{ o.billing.city}}</td>
        <td scope="row">{{ o.status}}</td>
        {% if o.date_paid == None %}
            <td scope="row">Unpaid</td>
            {% else %}
            <td scope="row">Paid</td>
        {% endif %}
        <td scope="row">{{ o.payment_method}}</td>
        <td scope="row">{{ o.date_created}}</td>
        <td scope="row">{{ o.total}}</td>
        <td scope="row">{{ o.total_refunds}}</td>
        <td scope="row">{{ o.total-o.total_refunds}}</td>
        <td scope="row">
          {% for wt in o.wt_messages%}
            {% if wt.status == "success"%}
              <span class="text-success">{{wt.template_name}}, </span>
            {%else%}
              <span class="text-danger">{{wt.template_name}}, </span>
            {% endif%}
          {% endfor %}
        </td>
      </tr>
      {% endfor %}
    </tbody>
  </table>
</div>
<nav aria-label="Page navigation example">
  <ul class="pagination justify-content-center">
    <li class="page-item {% if page == 1 %} disabled {%endif%}"><a href="{{url_for('woocom_orders', status=nav_active, page=page-1, order_ids=query['order_ids'])}}" class="page-link" href="#">Previous</a></li>
    <li class="page-item {% if orders|length < 20 %} disabled {%endif%}"><a href="{{url_for('woocom_orders', status=nav_active, page=page+1, order_ids=query['order_ids'])}}" class="page-link" href="#">Next</a></li>
  </ul>
</nav>

<script>
  function copyToClipboard(id) {
   console.log(id);
   var tag = document.getElementById(""+id+"")
   var text = tag.innerHTML.trim()
   var input = document.body.appendChild(document.createElement("textarea"));
   input.value = text;
   input.select();
   var status = document.execCommand("copy");
   input.parentNode.removeChild(input);
 }
 {% if is_w%}
 alert("{{query.w_status[0]}}")

 {% endif %}
 </script>
 
{% endblock %}
